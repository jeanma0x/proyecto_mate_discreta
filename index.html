<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Proyecto Matem√°tica Discreta - Maqueta Digital Interactiva</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: radial-gradient(circle at top, #020617 0, #020617 40%, #000 100%);
      color: #e5e7eb;
    }
    header {
      padding: 1rem 2rem;
      background: rgba(15, 23, 42, 0.96);
      border-bottom: 1px solid #1e293b;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 50;
    }
    header h1 {
      margin: 0;
      font-size: 1.2rem;
    }
    header span {
      font-size: 0.85rem;
      color: #9ca3af;
    }
    .container {
      max-width: 1180px;
      margin: 1.5rem auto 2.5rem;
      padding: 0 1rem;
    }
    .nav-tabs {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .nav-tabs button {
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.95);
      color: #e5e7eb;
      padding: 0.5rem 0.9rem;
      border-radius: 999px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: background 0.2s, transform 0.1s, box-shadow 0.2s;
    }
    .nav-tabs button.active {
      background: linear-gradient(to right, #2563eb, #4f46e5);
      box-shadow: 0 0 18px rgba(37, 99, 235, 0.45);
    }
    .nav-tabs button:hover {
      transform: translateY(-1px);
    }
    .view {
      display: none;
      border: 1px solid #1f2937;
      border-radius: 1.2rem;
      padding: 1.4rem;
      background: radial-gradient(circle at top left, #020617, #020617 40%, #000 100%);
      box-shadow: 0 30px 80px rgba(15, 23, 42, 0.9);
    }
    .view.active {
      display: block;
    }
    h2 {
      margin-top: 0;
      font-size: 1.1rem;
    }
    p {
      font-size: 0.9rem;
      color: #cbd5f5;
    }
    .flex {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
    }
    .panel {
      flex: 1 1 320px;
      min-width: 290px;
    }
    .panel h3 {
      margin-top: 0;
      font-size: 1rem;
    }
    .controls {
      margin-top: 0.5rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
      font-size: 0.85rem;
    }
    label {
      display: block;
      margin-bottom: 0.15rem;
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: #9ca3af;
    }
    select, input[type="number"], input[type="range"], button.action-btn {
      padding: 0.3rem 0.5rem;
      border-radius: 0.6rem;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.85rem;
    }
    input[type="number"] {
      width: 70px;
    }
    input[type="range"] {
      width: 100%;
    }
    button.action-btn {
      margin-top: 0.2rem;
      cursor: pointer;
      background: linear-gradient(to right, #2563eb, #4f46e5);
      border: none;
      font-weight: 500;
    }
    button.action-btn.secondary {
      background: #111827;
    }
    button.action-btn.danger {
      background: #b91c1c;
    }
    button.action-btn.success {
      background: #16a34a;
    }
    button.action-btn:hover {
      filter: brightness(1.1);
    }
    .result-box {
      margin-top: 0.3rem;
      padding: 0.6rem 0.8rem;
      border-radius: 0.8rem;
      background: rgba(15, 23, 42, 0.95);
      border: 1px solid #1f2937;
      font-size: 0.85rem;
      min-height: 3.2rem;
      white-space: pre-line;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid #1f2937;
      font-size: 0.7rem;
      color: #9ca3af;
      margin-bottom: 0.5rem;
    }
    .badge-dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 6px rgba(34, 197, 94, 0.9);
    }

    /* ---- TEOR√çA: flip cards ---- */
    .flip-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 0.8rem;
    }
    .flip-card {
      flex: 1 1 240px;
      perspective: 1000px;
      cursor: pointer;
    }
    .flip-inner {
      position: relative;
      width: 100%;
      height: 230px;
      transition: transform 0.6s;
      transform-style: preserve-3d;
      border-radius: 1rem;
      border: 1px solid #1f2937;
      background: rgba(15, 23, 42, 0.96);
      overflow: hidden;
    }
    .flip-card:hover .flip-inner,
    .flip-card.flipped .flip-inner {
      transform: rotateY(180deg);
    }
    .flip-face {
      position: absolute;
      inset: 0;
      padding: 0.9rem 1rem;
      backface-visibility: hidden;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .flip-front h3,
    .flip-back h3 {
      margin: 0 0 0.4rem 0;
      font-size: 0.95rem;
    }
    .flip-front p {
      font-size: 0.85rem;
      color: #cbd5f5;
    }
    .flip-front pre {
      font-size: 0.75rem;
      background: #020617;
      padding: 0.4rem 0.5rem;
      border-radius: 0.5rem;
      color: #e5e7eb;
    }
    .flip-back {
      transform: rotateY(180deg);
    }
    .flip-back ul {
      margin: 0.2rem 0 0 1rem;
      padding: 0;
      font-size: 0.85rem;
    }
    .flip-back code {
      font-size: 0.8rem;
      background: #020617;
      padding: 0.1rem 0.25rem;
      border-radius: 0.3rem;
    }

    /* ---- Transporte: mapa ---- */
    .graph-wrapper {
      position: relative;
      width: 520px;
      max-width: 100%;
      margin: 0 auto;
      border-radius: 1rem;
      overflow: hidden;
      background: #020617;
      border: 1px solid #1f2937;
      box-shadow: 0 22px 60px rgba(15, 23, 42, 0.95);
    }
    .map-background {
      position: absolute;
      inset: 0;
      background-image:
        linear-gradient(#0b1120 1px, transparent 1px),
        linear-gradient(90deg, #0b1120 1px, transparent 1px);
      background-size: 40px 40px;
      opacity: 0.6;
    }
    .map-district {
      position: absolute;
      border-radius: 1rem;
      opacity: 0.12;
    }
    .map-d1 { top: 20px; left: 30px; width: 150px; height: 90px; background: #22d3ee; }
    .map-d2 { top: 150px; left: 40px; width: 160px; height: 120px; background: #4ade80; }
    .map-d3 { top: 40px; right: 40px; width: 170px; height: 110px; background: #facc15; }
    .map-d4 { bottom: 30px; right: 50px; width: 180px; height: 120px; background: #fb7185; }

    #transport-graph {
      position: relative;
      width: 520px;
      max-width: 100%;
      height: 320px;
      display: block;
    }
    .road-edge {
      stroke: #111827;
      stroke-width: 10;
      stroke-linecap: round;
    }
    .road-lane {
      stroke: #4b5563;
      stroke-width: 2;
      stroke-linecap: round;
      stroke-dasharray: 6 6;
    }
    .edge {
      stroke: #94a3b8;
      stroke-width: 2;
      stroke-linecap: round;
      transition: stroke 0.2s, stroke-width 0.2s;
    }
    .edge.highlight {
      stroke: #22c55e;
      stroke-width: 4;
    }
    .node {
      fill: #0f172a;
      stroke: #38bdf8;
      stroke-width: 2;
      transition: transform 0.15s, fill 0.15s, stroke 0.15s;
    }
    .node:hover {
      transform: scale(1.08);
      fill: #1d4ed8;
      stroke: #93c5fd;
    }
    .node-label {
      fill: #e5e7eb;
      font-size: 10px;
      text-anchor: middle;
    }
    .node-desc {
      fill: #cbd5f5;
      font-size: 9px;
      text-anchor: middle;
    }
    .weight-label {
      fill: #9ca3af;
      font-size: 10px;
      text-anchor: middle;
    }
    .bus-icon {
      position: absolute;
      font-size: 22px;
      pointer-events: none;
      opacity: 0;
      filter: drop-shadow(0 0 6px rgba(59, 130, 246, 0.8));
      transition: opacity 0.2s;
    }
    .small-table {
      border-collapse: collapse;
      width: 100%;
      font-size: 0.8rem;
    }
    .small-table th, .small-table td {
      border: 1px solid #1f2937;
      padding: 0.25rem 0.4rem;
      text-align: center;
    }
    .small-table th {
      background: #020617;
      color: #9ca3af;
      font-weight: 500;
    }

    /* ---- Red el√©ctrica / agua ---- */
    #electric-graph {
      width: 520px;
      max-width: 100%;
      height: 320px;
      border-radius: 1rem;
      background: radial-gradient(circle at bottom, #020617, #030712);
      border: 1px solid #1f2937;
      box-shadow: 0 22px 60px rgba(15, 23, 42, 0.95);
    }
    .pipe-edge {
      stroke: #020617;
      stroke-width: 9;
      stroke-linecap: round;
    }
    .pipe-inner {
      stroke: #38bdf8;
      stroke-width: 4;
      stroke-linecap: round;
      transition: stroke 0.2s, stroke-width 0.2s;
    }
    .pipe-inner.mst-highlight {
      stroke: #22c55e;
      stroke-width: 6;
    }

    /* ---- Sem√°foros ---- */
    .intersection {
      position: relative;
      width: 340px;
      height: 340px;
      margin: 0 auto;
      background: radial-gradient(circle at center, #020617, #020617 40%, #000 100%);
      border-radius: 1.2rem;
      border: 1px solid #1f2937;
      box-shadow: 0 22px 60px rgba(15, 23, 42, 0.95);
    }
    .road {
      position: absolute;
      background: #111827;
    }
    .road.horizontal {
      top: 50%;
      left: 0;
      width: 100%;
      height: 80px;
      transform: translateY(-50%);
    }
    .road.vertical {
      left: 50%;
      top: 0;
      width: 80px;
      height: 100%;
      transform: translateX(-50%);
    }
    .lane-line {
      position: absolute;
      border-top: 2px dashed #4b5563;
      width: 100%;
      top: 50%;
      transform: translateY(-50%);
    }
    .lane-line-vert {
      position: absolute;
      border-left: 2px dashed #4b5563;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }
    .light-box {
      position: absolute;
      width: 44px;
      height: 100px;
      background: #020617;
      border-radius: 0.7rem;
      border: 1px solid #1e293b;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 8px 0;
    }
    .light {
      width: 18px;
      height: 18px;
      border-radius: 999px;
      background: #020617;
      box-shadow: 0 0 0 rgba(0,0,0,0);
    }
    .light.red.on {
      background: #ef4444;
      box-shadow: 0 0 14px rgba(248, 113, 113, 0.9);
    }
    .light.yellow.on {
      background: #facc15;
      box-shadow: 0 0 14px rgba(250, 204, 21, 0.9);
    }
    .light.green.on {
      background: #22c55e;
      box-shadow: 0 0 14px rgba(34, 197, 94, 0.9);
    }
    .north { top: 18px; left: 50%; transform: translateX(-50%); }
    .south { bottom: 18px; left: 50%; transform: translateX(-50%) rotate(180deg); }
    .west  { left: 18px; top: 50%; transform: translateY(-50%) rotate(90deg); }
    .east  { right: 18px; top: 50%; transform: translateY(-50%) rotate(-90deg); }

    .dir-label {
      position: absolute;
      font-size: 0.75rem;
      color: #9ca3af;
    }
    .dir-n { top: 6px; left: 50%; transform: translateX(-50%); }
    .dir-s { bottom: 6px; left: 50%; transform: translateX(-50%); }
    .dir-w { left: 6px; top: 50%; transform: translateY(-50%); }
    .dir-e { right: 6px; top: 50%; transform: translateY(-50%); }

    .range-value {
      font-size: 0.75rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>
<header>
  <div>
    <h1>Proyecto Matem√°tica Discreta ‚Äì Maqueta Digital Interactiva</h1>
    <span>Red de transporte ‚Ä¢ Red el√©ctrica / agua ‚Ä¢ Sistema de sem√°foros</span>
  </div>
  <span>Grafos + Dijkstra + MST</span>
</header>

<div class="container">
  <div class="nav-tabs">
    <button class="tab-btn active" data-target="teoria">1. Teor√≠a y funcionamiento</button>
    <button class="tab-btn" data-target="transporte">2. Red de transporte</button>
    <button class="tab-btn" data-target="electrica">3. Red el√©ctrica / agua</button>
    <button class="tab-btn" data-target="semaforos">4. Sistema de sem√°foros</button>
  </div>

  <!-- TEOR√çA -->
  <section id="teoria" class="view active">
    <span class="badge"><span class="badge-dot"></span> Qu√© hace cada parte de la maqueta</span>
    <h2>Resumen te√≥rico y c√≥mo usar la maqueta digital</h2>
    <p>
      Esta p√°gina modela tres sistemas reales usando <strong>grafos</strong>:
      una red de transporte, una red de distribuci√≥n (el√©ctrica/agua) y un sistema de sem√°foros.
      En todos los casos:
    </p>
    <ul style="font-size:0.9rem; color:#cbd5f5;">
      <li>Los <strong>nodos</strong> representan lugares o dispositivos (paradas, subestaciones, cruces).</li>
      <li>Las <strong>aristas</strong> representan conexiones (carreteras, tuber√≠as, calles).</li>
      <li>Los <strong>pesos</strong> representan distancia, costo o tiempo.</li>
      <li>T√∫ puedes <strong>modificar par√°metros</strong> y ver nuevos escenarios.</li>
    </ul>

    <div class="flip-grid">
      <!-- Flip 1: Grafo -->
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-face flip-front">
            <h3>Grafos y grafos ponderados</h3>
            <p>Un mapa, una red el√©ctrica o un cruce de calles se pueden ver como un grafo.</p>
            <pre>
‚óè‚îÄ‚îÄ‚îÄ‚óè‚îÄ‚îÄ‚îÄ‚óè
 \   ‚îÇ
  \  ‚óè
(pesos en las aristas)
            </pre>
            <p style="font-size:0.8rem;color:#9ca3af;">
              Pulsa la tarjeta para ver la explicaci√≥n r√°pida.
            </p>
          </div>
          <div class="flip-face flip-back">
            <h3>Definiciones clave</h3>
            <ul>
              <li><strong>V√©rtices</strong>: puntos de inter√©s (lugares, estaciones, cruces).</li>
              <li><strong>Aristas</strong>: conexiones entre v√©rtices.</li>
              <li><strong>Peso</strong>: n√∫mero asociado a una arista
                (km, costo, tiempo, capacidad).</li>
              <li>Un <strong>grafo ponderado</strong> es un grafo donde
                cada arista tiene un peso.</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Flip 2: Dijkstra -->
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-face flip-front">
            <h3>Red de transporte y Dijkstra</h3>
            <p>Buscamos la ruta m√°s corta entre dos puntos de la ciudad.</p>
            <pre>
A‚îÄ‚îÄ4‚îÄ‚îÄB‚îÄ‚îÄ5‚îÄ‚îÄD
‚îÇ  \1 ‚îÇ
2   \ C
 \    \
  E‚îÄ‚îÄ3‚îÄ‚îÄF
            </pre>
            <p style="font-size:0.8rem;color:#9ca3af;">
              El bus recorre el camino resaltado con distancia m√≠nima.
            </p>
          </div>
          <div class="flip-face flip-back">
            <h3>Algoritmo de Dijkstra</h3>
            <ul>
              <li>Distancia inicial del origen = 0; resto = ‚àû.</li>
              <li>Tomar siempre el nodo no visitado con menor distancia.</li>
              <li><strong>Relajar</strong> sus vecinos:
                si pasar por √©l mejora la distancia, se actualiza.</li>
              <li>En la maqueta:
                <ul>
                  <li>Eliges origen y destino.</li>
                  <li>Se calcula el camino m√°s corto con los pesos que hayas puesto.</li>
                  <li>Se resalta la ruta y se anima el bus.</li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Flip 3: MST -->
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-face flip-front">
            <h3>Red el√©ctrica / agua y MST</h3>
            <p>Queremos conectar todos los nodos al menor costo.</p>
            <pre>
   P‚îÄ‚îÄ‚îÄQ‚îÄ‚îÄ‚îÄS‚îÄ‚îÄ‚îÄU
    \  ‚îÇ  /
      R‚îÄ‚îÄT
(MST = √°rbol sin ciclos)
            </pre>
          </div>
          <div class="flip-face flip-back">
            <h3>√Årbol de Expansi√≥n M√≠nima</h3>
            <ul>
              <li>Un <strong>MST</strong> conecta todos los nodos:</li>
              <li>‚ô¶ Sin ciclos.</li>
              <li>‚ô¶ Con costo total m√≠nimo.</li>
              <li>Prim:
                <ul>
                  <li>Empieza en un nodo cualquiera.</li>
                  <li>Agrega siempre la arista m√°s barata que conecta
                    un nodo nuevo al √°rbol actual.</li>
                  <li>En la maqueta, esas aristas se ven en verde.</li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Flip 4: Sem√°foros -->
      <div class="flip-card">
        <div class="flip-inner">
          <div class="flip-face flip-front">
            <h3>Sistema de sem√°foros</h3>
            <p>El cruce alterna el flujo Norte‚ÄìSur y Este‚ÄìOeste.</p>
            <pre>
N ‚Üë   ‚îÇ   ‚Üë N
  ‚îÇ   ‚îÇ   ‚îÇ
W ‚îú‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚î§ E
  ‚îÇ   ‚îÇ   ‚îÇ
S ‚Üì   ‚îÇ   ‚Üì S
            </pre>
          </div>
          <div class="flip-face flip-back">
            <h3>Grafos y tiempos</h3>
            <ul>
              <li>Cada calle es una arista.</li>
              <li>Cuando una direcci√≥n est√° en verde, esas aristas est√°n activas.</li>
              <li>Los sliders controlan:
                <ul>
                  <li>Segundos de verde para N‚ÄìS.</li>
                  <li>Segundos de verde para E‚ÄìO.</li>
                  <li>Segundos de amarillo.</li>
                </ul>
              </li>
              <li>M√°s tiempo verde ‚áí m√°s ‚Äúcapacidad‚Äù para esa direcci√≥n
                en el grafo de tr√°fico.</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- RED DE TRANSPORTE -->
  <section id="transporte" class="view">
    <span class="badge"><span class="badge-dot"></span> Grafo de ciudad editable + Dijkstra + bus animado</span>
    <h2>Red f√≠sica de transporte (puedes cambiar distancias y rutas)</h2>
    <p>
      Esta secci√≥n simula una peque√±a ciudad. Puedes <strong>modificar las distancias</strong> de las carreteras
      y recalcular la ruta m√°s corta entre dos puntos con Dijkstra. El bus recorre visualmente el camino √≥ptimo.
    </p>

    <div class="flex">
      <div class="panel">
        <h3>Mapa de la ciudad</h3>
        <div class="graph-wrapper">
          <div class="map-background"></div>
          <div class="map-district map-d1"></div>
          <div class="map-district map-d2"></div>
          <div class="map-district map-d3"></div>
          <div class="map-district map-d4"></div>

          <svg id="transport-graph" viewBox="0 0 500 320">
            <!-- Carreteras gruesas tipo mapa -->
            <line class="road-edge" x1="80" y1="70" x2="250" y2="60" />
            <line class="road-edge" x1="80" y1="70" x2="140" y2="170" />
            <line class="road-edge" x1="250" y1="60" x2="140" y2="170" />
            <line class="road-edge" x1="250" y1="60" x2="350" y2="150" />
            <line class="road-edge" x1="140" y1="170" x2="350" y2="150" />
            <line class="road-edge" x1="140" y1="170" x2="200" y2="260" />
            <line class="road-edge" x1="350" y1="150" x2="200" y2="260" />
            <line class="road-edge" x1="350" y1="150" x2="430" y2="230" />
            <line class="road-edge" x1="200" y1="260" x2="430" y2="230" />

            <!-- L√≠neas de carril centrales -->
            <line class="road-lane" x1="80" y1="70" x2="250" y2="60" />
            <line class="road-lane" x1="80" y1="70" x2="140" y2="170" />
            <line class="road-lane" x1="250" y1="60" x2="140" y2="170" />
            <line class="road-lane" x1="250" y1="60" x2="350" y2="150" />
            <line class="road-lane" x1="140" y1="170" x2="350" y2="150" />
            <line class="road-lane" x1="140" y1="170" x2="200" y2="260" />
            <line class="road-lane" x1="350" y1="150" x2="200" y2="260" />
            <line class="road-lane" x1="350" y1="150" x2="430" y2="230" />
            <line class="road-lane" x1="200" y1="260" x2="430" y2="230" />

            <!-- Aristas para resaltado -->
            <line id="edge-A-B" class="edge" x1="80" y1="70" x2="250" y2="60" />
            <line id="edge-A-C" class="edge" x1="80" y1="70" x2="140" y2="170" />
            <line id="edge-B-C" class="edge" x1="250" y1="60" x2="140" y2="170" />
            <line id="edge-B-D" class="edge" x1="250" y1="60" x2="350" y2="150" />
            <line id="edge-C-D" class="edge" x1="140" y1="170" x2="350" y2="150" />
            <line id="edge-C-E" class="edge" x1="140" y1="170" x2="200" y2="260" />
            <line id="edge-D-E" class="edge" x1="350" y1="150" x2="200" y2="260" />
            <line id="edge-D-F" class="edge" x1="350" y1="150" x2="430" y2="230" />
            <line id="edge-E-F" class="edge" x1="200" y1="260" x2="430" y2="230" />

            <!-- Pesos (distancias) -->
            <text id="label-A-B" class="weight-label" x="165" y="55">4 km</text>
            <text id="label-A-C" class="weight-label" x="100" y="120">2 km</text>
            <text id="label-B-C" class="weight-label" x="195" y="120">1 km</text>
            <text id="label-B-D" class="weight-label" x="310" y="90">5 km</text>
            <text id="label-C-D" class="weight-label" x="245" y="165">8 km</text>
            <text id="label-C-E" class="weight-label" x="160" y="230">10 km</text>
            <text id="label-D-E" class="weight-label" x="275" y="215">2 km</text>
            <text id="label-D-F" class="weight-label" x="390" y="185">6 km</text>
            <text id="label-E-F" class="weight-label" x="320" y="250">3 km</text>

            <!-- Nodos -->
            <circle class="node" cx="80" cy="70" r="15" />
            <text class="node-label" x="80" y="70">A</text>
            <text class="node-desc"  x="80" y="92">Terminal</text>

            <circle class="node" cx="250" cy="60" r="15" />
            <text class="node-label" x="250" y="60">B</text>
            <text class="node-desc"  x="250" y="82">Centro</text>

            <circle class="node" cx="140" cy="170" r="15" />
            <text class="node-label" x="140" y="170">C</text>
            <text class="node-desc"  x="140" y="192">Mercado</text>

            <circle class="node" cx="350" cy="150" r="15" />
            <text class="node-label" x="350" y="150">D</text>
            <text class="node-desc"  x="350" y="172">Univ.</text>

            <circle class="node" cx="200" cy="260" r="15" />
            <text class="node-label" x="200" y="260">E</text>
            <text class="node-desc"  x="200" y="282">Hospital</text>

            <circle class="node" cx="430" cy="230" r="15" />
            <text class="node-label" x="430" y="230">F</text>
            <text class="node-desc"  x="430" y="252">Centro Com.</text>
          </svg>
          <div id="bus-icon" class="bus-icon">üöç</div>
        </div>
      </div>

      <div class="panel">
        <h3>Par√°metros de la red y simulaci√≥n</h3>
        <div class="controls">
          <div>
            <label>Distancias de las carreteras (km)</label>
            <table class="small-table">
              <thead>
              <tr><th>Arista</th><th>Peso</th></tr>
              </thead>
              <tbody>
              <tr><td>A ‚Äì B</td><td><input id="input-A-B" type="number" min="1" step="1" value="4"></td></tr>
              <tr><td>A ‚Äì C</td><td><input id="input-A-C" type="number" min="1" step="1" value="2"></td></tr>
              <tr><td>B ‚Äì C</td><td><input id="input-B-C" type="number" min="1" step="1" value="1"></td></tr>
              <tr><td>B ‚Äì D</td><td><input id="input-B-D" type="number" min="1" step="1" value="5"></td></tr>
              <tr><td>C ‚Äì D</td><td><input id="input-C-D" type="number" min="1" step="1" value="8"></td></tr>
              <tr><td>C ‚Äì E</td><td><input id="input-C-E" type="number" min="1" step="1" value="10"></td></tr>
              <tr><td>D ‚Äì E</td><td><input id="input-D-E" type="number" min="1" step="1" value="2"></td></tr>
              <tr><td>D ‚Äì F</td><td><input id="input-D-F" type="number" min="1" step="1" value="6"></td></tr>
              <tr><td>E ‚Äì F</td><td><input id="input-E-F" type="number" min="1" step="1" value="3"></td></tr>
              </tbody>
            </table>
          </div>

          <div>
            <label>Origen y destino</label>
            <select id="origen">
              <option value="A">A ‚Äì Terminal</option>
              <option value="B">B ‚Äì Centro</option>
              <option value="C">C ‚Äì Mercado</option>
              <option value="D">D ‚Äì Universidad</option>
              <option value="E">E ‚Äì Hospital</option>
              <option value="F">F ‚Äì Centro Comercial</option>
            </select>
            <select id="destino" style="margin-top:0.3rem;">
              <option value="A">A ‚Äì Terminal</option>
              <option value="B">B ‚Äì Centro</option>
              <option value="C">C ‚Äì Mercado</option>
              <option value="D">D ‚Äì Universidad</option>
              <option value="E">E ‚Äì Hospital</option>
              <option value="F" selected>F ‚Äì Centro Comercial</option>
            </select>
          </div>

          <button class="action-btn" id="btn-dijkstra">
            Calcular ruta m√°s corta
          </button>
          <button class="action-btn success" id="btn-anim-bus">
            Animar recorrido del bus
          </button>
          <button class="action-btn secondary" id="btn-reset-dijkstra">
            Limpiar resaltado / reiniciar bus
          </button>
          <button class="action-btn secondary" id="btn-random-weights">
            Randomizar distancias (escenario alterno)
          </button>

          <div class="result-box" id="resultado-dijkstra">
            1) Ajusta los km de las aristas si quieres.  
            2) Elige origen y destino.  
            3) Presiona ‚ÄúCalcular ruta m√°s corta‚Äù.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- RED EL√âCTRICA / AGUA -->
  <section id="electrica" class="view">
    <span class="badge"><span class="badge-dot"></span> Red de distribuci√≥n editable + MST</span>
    <h2>Maqueta de red el√©ctrica / de agua (puedes cambiar costos)</h2>
    <p>
      Aqu√≠ los pesos representan <strong>costos</strong> de instalaci√≥n de cables/tuber√≠as.
      Puedes editar cada costo y ver c√≥mo cambia el <strong>√°rbol de expansi√≥n m√≠nima</strong>
      (MST) obtenido con el algoritmo de Prim.
    </p>

    <div class="flex">
      <div class="panel">
        <h3>Red de distribuci√≥n ‚ö° / üíß</h3>
        <svg id="electric-graph" viewBox="0 0 500 320">
          <!-- Tubos/cables gruesos -->
          <line class="pipe-edge" x1="70" y1="80" x2="230" y2="60" />
          <line class="pipe-edge" x1="70" y1="80" x2="140" y2="200" />
          <line class="pipe-edge" x1="230" y1="60" x2="140" y2="200" />
          <line class="pipe-edge" x1="230" y1="60" x2="360" y2="90" />
          <line class="pipe-edge" x1="140" y1="200" x2="260" y2="250" />
          <line class="pipe-edge" x1="360" y1="90" x2="260" y2="250" />
          <line class="pipe-edge" x1="360" y1="90" x2="430" y2="210" />
          <line class="pipe-edge" x1="260" y1="250" x2="430" y2="210" />

          <!-- Tubos interiores (aristas MST) -->
          <line id="edge-P-Q" class="pipe-inner" x1="70" y1="80" x2="230" y2="60" />
          <line id="edge-P-R" class="pipe-inner" x1="70" y1="80" x2="140" y2="200" />
          <line id="edge-Q-R" class="pipe-inner" x1="230" y1="60" x2="140" y2="200" />
          <line id="edge-Q-S" class="pipe-inner" x1="230" y1="60" x2="360" y2="90" />
          <line id="edge-R-T" class="pipe-inner" x1="140" y1="200" x2="260" y2="250" />
          <line id="edge-S-T" class="pipe-inner" x1="360" y1="90" x2="260" y2="250" />
          <line id="edge-S-U" class="pipe-inner" x1="360" y1="90" x2="430" y2="210" />
          <line id="edge-T-U" class="pipe-inner" x1="260" y1="250" x2="430" y2="210" />

          <!-- Pesos (costos) -->
          <text id="cost-P-Q" class="weight-label" x="150" y="60">6</text>
          <text id="cost-P-R" class="weight-label" x="100" y="145">4</text>
          <text id="cost-Q-R" class="weight-label" x="185" y="140">5</text>
          <text id="cost-Q-S" class="weight-label" x="300" y="65">3</text>
          <text id="cost-R-T" class="weight-label" x="205" y="235">4</text>
          <text id="cost-S-T" class="weight-label" x="315" y="180">7</text>
          <text id="cost-S-U" class="weight-label" x="395" y="150">2</text>
          <text id="cost-T-U" class="weight-label" x="345" y="240">6</text>

          <!-- Nodos -->
          <circle class="node" cx="70" cy="80" r="15" />
          <text class="node-label" x="70" y="80">P</text>
          <text class="node-desc" x="70" y="102">Planta</text>

          <circle class="node" cx="230" cy="60" r="15" />
          <text class="node-label" x="230" y="60">Q</text>
          <text class="node-desc" x="230" y="82">Subest. N</text>

          <circle class="node" cx="140" cy="200" r="15" />
          <text class="node-label" x="140" y="200">R</text>
          <text class="node-desc" x="140" y="222">Subest. S</text>

          <circle class="node" cx="360" cy="90" r="15" />
          <text class="node-label" x="360" y="90">S</text>
          <text class="node-desc" x="360" y="112">Nodo Este</text>

          <circle class="node" cx="260" cy="250" r="15" />
          <text class="node-label" x="260" y="250">T</text>
          <text class="node-desc" x="260" y="272">Nodo Oeste</text>

          <circle class="node" cx="430" cy="210" r="15" />
          <text class="node-label" x="430" y="210">U</text>
          <text class="node-desc" x="430" y="232">Cliente</text>
        </svg>
      </div>

      <div class="panel">
        <h3>Par√°metros de costos y MST</h3>
        <div class="controls">
          <div>
            <label>Costos de cada conexi√≥n</label>
            <table class="small-table">
              <thead><tr><th>Arista</th><th>Costo</th></tr></thead>
              <tbody>
              <tr><td>P ‚Äì Q</td><td><input id="cost-input-P-Q" type="number" min="1" step="1" value="6"></td></tr>
              <tr><td>P ‚Äì R</td><td><input id="cost-input-P-R" type="number" min="1" step="1" value="4"></td></tr>
              <tr><td>Q ‚Äì R</td><td><input id="cost-input-Q-R" type="number" min="1" step="1" value="5"></td></tr>
              <tr><td>Q ‚Äì S</td><td><input id="cost-input-Q-S" type="number" min="1" step="1" value="3"></td></tr>
              <tr><td>R ‚Äì T</td><td><input id="cost-input-R-T" type="number" min="1" step="1" value="4"></td></tr>
              <tr><td>S ‚Äì T</td><td><input id="cost-input-S-T" type="number" min="1" step="1" value="7"></td></tr>
              <tr><td>S ‚Äì U</td><td><input id="cost-input-S-U" type="number" min="1" step="1" value="2"></td></tr>
              <tr><td>T ‚Äì U</td><td><input id="cost-input-T-U" type="number" min="1" step="1" value="6"></td></tr>
              </tbody>
            </table>
          </div>

          <button class="action-btn" id="btn-mst">
            Calcular y resaltar MST
          </button>
          <button class="action-btn secondary" id="btn-reset-mst">
            Limpiar resaltado
          </button>

          <div class="result-box" id="resultado-mst">
            Edita los costos si quieres probar otro escenario y luego presiona ‚ÄúCalcular y resaltar MST‚Äù.
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- SISTEMA DE SEM√ÅFOROS -->
  <section id="semaforos" class="view">
    <span class="badge"><span class="badge-dot"></span> Sem√°foros con tiempos configurables y fallo</span>
    <h2>Sistema f√≠sico de sem√°foros (puedes ajustar los tiempos)</h2>
    <p>
      Esta intersecci√≥n controla el paso norte-sur y este-oeste. Puedes cambiar los segundos de verde y amarillo
      y observar el ciclo. Tambi√©n puedes simular un fallo en la direcci√≥n norte-sur.
    </p>

    <div class="flex">
      <div class="panel">
        <h3>Intersecci√≥n y sem√°foros üö¶</h3>
        <div class="intersection">
          <div class="road horizontal">
            <div class="lane-line"></div>
          </div>
          <div class="road vertical">
            <div class="lane-line-vert"></div>
          </div>

          <div class="light-box north">
            <div id="north-red" class="light red"></div>
            <div id="north-yellow" class="light yellow"></div>
            <div id="north-green" class="light green"></div>
          </div>

          <div class="light-box south">
            <div id="south-red" class="light red"></div>
            <div id="south-yellow" class="light yellow"></div>
            <div id="south-green" class="light green"></div>
          </div>

          <div class="light-box west">
            <div id="west-red" class="light red"></div>
            <div id="west-yellow" class="light yellow"></div>
            <div id="west-green" class="light green"></div>
          </div>

          <div class="light-box east">
            <div id="east-red" class="light red"></div>
            <div id="east-yellow" class="light yellow"></div>
            <div id="east-green" class="light green"></div>
          </div>

          <div class="dir-label dir-n">N</div>
          <div class="dir-label dir-s">S</div>
          <div class="dir-label dir-w">O</div>
          <div class="dir-label dir-e">E</div>
        </div>
      </div>

      <div class="panel">
        <h3>Tiempos de ciclo y simulaci√≥n</h3>
        <div class="controls">
          <div>
            <label>Verde norte-sur (seg)</label>
            <input id="range-ns-green" type="range" min="2" max="10" value="4">
            <div class="range-value">Actual: <span id="val-ns-green">4 s</span></div>
          </div>
          <div>
            <label>Verde este-oeste (seg)</label>
            <input id="range-ew-green" type="range" min="2" max="10" value="4">
            <div class="range-value">Actual: <span id="val-ew-green">4 s</span></div>
          </div>
          <div>
            <label>Amarillo (aplica a ambos) (seg)</label>
            <input id="range-yellow" type="range" min="1" max="5" value="2">
            <div class="range-value">Actual: <span id="val-yellow">2 s</span></div>
          </div>

          <div class="range-value" style="margin-top:0.3rem;">
            Ciclo total estimado: <span id="sem-cycle">12 s</span> ‚Äì
            N‚ÄìS verde: <span id="sem-ns-perc">33%</span>,
            E‚ÄìO verde: <span id="sem-ew-perc">33%</span>,
            Amarillo total: <span id="sem-y-perc">33%</span>.
          </div>

          <button class="action-btn" id="btn-start-sem">
            Iniciar ciclo con estos tiempos
          </button>
          <button class="action-btn secondary" id="btn-stop-sem">
            Detener ciclo (todo rojo)
          </button>
          <button class="action-btn danger" id="btn-fallo">
            Simular fallo en norte-sur
          </button>

          <div class="result-box" id="resultado-sem">
            Ajusta los tiempos, luego presiona ‚ÄúIniciar ciclo de sem√°foros‚Äù.
          </div>
          <p style="font-size:0.8rem; margin-top:0.5rem;">
            Desde grafos: cuando una direcci√≥n est√° en rojo (o falla), es como si se desactivaran
            temporalmente esas aristas, reduciendo los caminos disponibles entre los v√©rtices de la red vial.
          </p>
        </div>
      </div>
    </div>
  </section>
</div>

<script>
  // Navegaci√≥n de pesta√±as
  document.querySelectorAll(".tab-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      document.querySelectorAll(".tab-btn").forEach(b => b.classList.remove("active"));
      document.querySelectorAll(".view").forEach(v => v.classList.remove("active"));
      btn.classList.add("active");
      const target = btn.getAttribute("data-target");
      document.getElementById(target).classList.add("active");
    });
  });

  // Flip cards clic en m√≥vil
  document.querySelectorAll(".flip-card").forEach(card => {
    card.addEventListener("click", () => {
      card.classList.toggle("flipped");
    });
  });

  // ==========================
  // 1. RED DE TRANSPORTE ‚Äì DIJKSTRA + BUS
  // ==========================

  const transportEdges = [
    { id: "A-B", u: "A", v: "B", inputId: "input-A-B", labelId: "label-A-B" },
    { id: "A-C", u: "A", v: "C", inputId: "input-A-C", labelId: "label-A-C" },
    { id: "B-C", u: "B", v: "C", inputId: "input-B-C", labelId: "label-B-C" },
    { id: "B-D", u: "B", v: "D", inputId: "input-B-D", labelId: "label-B-D" },
    { id: "C-D", u: "C", v: "D", inputId: "input-C-D", labelId: "label-C-D" },
    { id: "C-E", u: "C", v: "E", inputId: "input-C-E", labelId: "label-C-E" },
    { id: "D-E", u: "D", v: "E", inputId: "input-D-E", labelId: "label-D-E" },
    { id: "D-F", u: "D", v: "F", inputId: "input-D-F", labelId: "label-D-F" },
    { id: "E-F", u: "E", v: "F", inputId: "input-E-F", labelId: "label-E-F" },
  ];

  const nodeCoords = {
    A: { x: 80,  y: 70  },
    B: { x: 250, y: 60  },
    C: { x: 140, y: 170 },
    D: { x: 350, y: 150 },
    E: { x: 200, y: 260 },
    F: { x: 430, y: 230 }
  };

  const busIcon = document.getElementById("bus-icon");
  let lastTransportPath = null;
  let busInterval = null;

  function buildTransportGraph() {
    const graph = {};
    ["A","B","C","D","E","F"].forEach(n => { graph[n] = {}; });

    for (const edge of transportEdges) {
      const input = document.getElementById(edge.inputId);
      const w = parseFloat(input.value);
      if (isNaN(w) || w <= 0) continue;
      graph[edge.u][edge.v] = w;
      graph[edge.v][edge.u] = w;
    }
    return graph;
  }

  // Actualizar textos de etiquetas al cambiar inputs
  transportEdges.forEach(edge => {
    const input = document.getElementById(edge.inputId);
    const label = document.getElementById(edge.labelId);
    input.addEventListener("input", () => {
      const v = parseFloat(input.value);
      if (!isNaN(v) && v > 0) {
        label.textContent = v + " km";
      } else {
        label.textContent = "-";
      }
    });
  });

  function clearTransportHighlight() {
    document.querySelectorAll("#transport-graph .edge").forEach(e => {
      e.classList.remove("highlight");
    });
  }

  function highlightTransportPath(path) {
    clearTransportHighlight();
    for (let i = 0; i < path.length - 1; i++) {
      const u = path[i];
      const v = path[i + 1];
      const id1 = `edge-${u}-${v}`;
      const id2 = `edge-${v}-${u}`;
      const edgeEl = document.getElementById(id1) || document.getElementById(id2);
      if (edgeEl) {
        edgeEl.classList.add("highlight");
      }
    }
  }

  function dijkstra(graph, start) {
    const dist = {};
    const prev = {};
    const unvisited = new Set(Object.keys(graph));
    for (const node of unvisited) {
      dist[node] = Infinity;
      prev[node] = null;
    }
    dist[start] = 0;

    while (unvisited.size > 0) {
      let u = null;
      let minDist = Infinity;
      for (const node of unvisited) {
        if (dist[node] < minDist) {
          minDist = dist[node];
          u = node;
        }
      }
      if (u === null || dist[u] === Infinity) break;
      unvisited.delete(u);
      for (const [v, w] of Object.entries(graph[u])) {
        if (!unvisited.has(v)) continue;
        const alt = dist[u] + w;
        if (alt < dist[v]) {
          dist[v] = alt;
          prev[v] = u;
        }
      }
    }
    return { dist, prev };
  }

  function reconstructPath(prev, start, end) {
    const path = [];
    let cur = end;
    while (cur !== null) {
      path.push(cur);
      cur = prev[cur];
    }
    path.reverse();
    if (path[0] === start && path.every(p => p !== undefined)) return path;
    return null;
  }

  function setBusPosition(x, y) {
    if (!busIcon) return;
    busIcon.style.left = (x - 11) + "px";
    busIcon.style.top  = (y - 15) + "px";
    busIcon.style.opacity = "1";
  }

  function animateBusAlong(path) {
    if (!path || path.length < 2 || !busIcon) return;
    if (busInterval) clearInterval(busInterval);

    let segIndex = 0;
    let step = 0;
    const stepsPerSegment = 30;
    const delay = 40;

    busInterval = setInterval(() => {
      const fromNode = path[segIndex];
      const toNode   = path[segIndex + 1];
      const from = nodeCoords[fromNode];
      const to   = nodeCoords[toNode];
      if (!from || !to) return;

      const t = step / stepsPerSegment;
      const x = from.x + (to.x - from.x) * t;
      const y = from.y + (to.y - from.y) * t;
      setBusPosition(x, y);

      step++;
      if (step > stepsPerSegment) {
        segIndex++;
        step = 0;
        if (segIndex >= path.length - 1) {
          clearInterval(busInterval);
        }
      }
    }, delay);
  }

  document.getElementById("btn-dijkstra").addEventListener("click", () => {
    const origen = document.getElementById("origen").value;
    const destino = document.getElementById("destino").value;
    const box = document.getElementById("resultado-dijkstra");

    const graph = buildTransportGraph();
    const { dist, prev } = dijkstra(graph, origen);
    const path = reconstructPath(prev, origen, destino);

    if (!path) {
      box.textContent = "No existe un camino v√°lido entre " + origen + " y " + destino +
        ". Revisa que todas las aristas necesarias tengan un peso v√°lido (> 0).";
      clearTransportHighlight();
      lastTransportPath = null;
      if (busIcon) busIcon.style.opacity = "0";
      return;
    }

    highlightTransportPath(path);
    const distancia = dist[destino];
    box.textContent =
      "Ruta m√°s corta de " + origen + " a " + destino + ":\n" +
      path.join(" ‚Üí ") + "\n\n" +
      "Distancia total: " + distancia + " km.";

    lastTransportPath = path;
    const start = nodeCoords[path[0]];
    if (start) setBusPosition(start.x, start.y);
  });

  document.getElementById("btn-reset-dijkstra").addEventListener("click", () => {
    clearTransportHighlight();
    document.getElementById("resultado-dijkstra").textContent =
      "Resaltado limpiado. Vuelve a calcular una ruta si lo deseas.";
    lastTransportPath = null;
    if (busInterval) clearInterval(busInterval);
    if (busIcon) busIcon.style.opacity = "0";
  });

  document.getElementById("btn-anim-bus").addEventListener("click", () => {
    const box = document.getElementById("resultado-dijkstra");
    if (!lastTransportPath) {
      box.textContent =
        "Primero calcula una ruta m√°s corta, luego podr√°s animar el recorrido del bus.";
      return;
    }
    animateBusAlong(lastTransportPath);
  });

  document.getElementById("btn-random-weights").addEventListener("click", () => {
    // randomiza pesos entre 1 y 12 km
    transportEdges.forEach(edge => {
      const input = document.getElementById(edge.inputId);
      const label = document.getElementById(edge.labelId);
      const val = Math.floor(Math.random() * 12) + 1;
      input.value = val;
      label.textContent = val + " km";
    });
    document.getElementById("resultado-dijkstra").textContent =
      "Se gener√≥ un escenario alterno con distancias aleatorias. Ahora puedes recalcular rutas.";
    clearTransportHighlight();
    lastTransportPath = null;
    if (busInterval) clearInterval(busInterval);
    if (busIcon) busIcon.style.opacity = "0";
  });

  // Posici√≥n inicial del bus en A
  const startA = nodeCoords["A"];
  if (startA) setBusPosition(startA.x, startA.y);

  // ==========================
  // 2. RED EL√âCTRICA / AGUA ‚Äì MST (Prim) editable
  // ==========================

  const electricEdges = [
    { id: "P-Q", u: "P", v: "Q", inputId: "cost-input-P-Q", labelId: "cost-P-Q" },
    { id: "P-R", u: "P", v: "R", inputId: "cost-input-P-R", labelId: "cost-P-R" },
    { id: "Q-R", u: "Q", v: "R", inputId: "cost-input-Q-R", labelId: "cost-Q-R" },
    { id: "Q-S", u: "Q", v: "S", inputId: "cost-input-Q-S", labelId: "cost-Q-S" },
    { id: "R-T", u: "R", v: "T", inputId: "cost-input-R-T", labelId: "cost-R-T" },
    { id: "S-T", u: "S", v: "T", inputId: "cost-input-S-T", labelId: "cost-S-T" },
    { id: "S-U", u: "S", v: "U", inputId: "cost-input-S-U", labelId: "cost-S-U" },
    { id: "T-U", u: "T", v: "U", inputId: "cost-input-T-U", labelId: "cost-T-U" },
  ];

  function buildElectricGraph() {
    const graph = {};
    ["P","Q","R","S","T","U"].forEach(n => { graph[n] = {}; });

    for (const edge of electricEdges) {
      const input = document.getElementById(edge.inputId);
      const w = parseFloat(input.value);
      if (isNaN(w) || w <= 0) continue;
      graph[edge.u][edge.v] = w;
      graph[edge.v][edge.u] = w;
    }
    return graph;
  }

  // actualizar etiquetas de costos
  electricEdges.forEach(edge => {
    const input = document.getElementById(edge.inputId);
    const label = document.getElementById(edge.labelId);
    input.addEventListener("input", () => {
      const v = parseFloat(input.value);
      if (!isNaN(v) && v > 0) {
        label.textContent = v.toString();
      } else {
        label.textContent = "-";
      }
    });
  });

  function clearMSTHighlight() {
    document.querySelectorAll("#electric-graph .pipe-inner").forEach(e => {
      e.classList.remove("mst-highlight");
    });
  }

  function highlightMSTEdges(edges) {
    clearMSTHighlight();
    for (const edge of edges) {
      const id1 = `edge-${edge.u}-${edge.v}`;
      const id2 = `edge-${edge.v}-${edge.u}`;
      const el = document.getElementById(id1) || document.getElementById(id2);
      if (el) el.classList.add("mst-highlight");
    }
  }

  function primMST(graph) {
    const nodes = Object.keys(graph);
    if (nodes.length === 0) return [];
    const inMST = new Set();
    const edges = [];
    inMST.add(nodes[0]);

    while (inMST.size < nodes.length) {
      let minEdge = null;
      let minWeight = Infinity;

      for (const u of inMST) {
        for (const [v, w] of Object.entries(graph[u])) {
          if (inMST.has(v)) continue;
          if (w < minWeight) {
            minWeight = w;
            minEdge = { u, v, w };
          }
        }
      }

      if (!minEdge) break; // grafo desconectado
      inMST.add(minEdge.v);
      edges.push(minEdge);
    }
    return edges;
  }

  document.getElementById("btn-mst").addEventListener("click", () => {
    const graph = buildElectricGraph();
    const mst = primMST(graph);
    const box = document.getElementById("resultado-mst");

    if (mst.length === 0) {
      box.textContent = "No se pudo construir un MST. Verifica que las aristas tengan costos v√°lidos y que el grafo est√© conectado.";
      clearMSTHighlight();
      return;
    }

    highlightMSTEdges(mst);
    const total = mst.reduce((acc, e) => acc + e.w, 0);
    let texto = "Aristas en el MST (origen, destino, costo):\n";
    mst.forEach(e => {
      texto += `${e.u} ‚Äì ${e.v} (costo ${e.w})\n`;
    });
    texto += `\nCosto total m√≠nimo para esta configuraci√≥n: ${total}.`;
    box.textContent = texto;
  });

  document.getElementById("btn-reset-mst").addEventListener("click", () => {
    clearMSTHighlight();
    document.getElementById("resultado-mst").textContent =
      "Resaltado limpiado. Edita costos y vuelve a calcular el MST si lo deseas.";
  });

  // ==========================
  // 3. SISTEMA DE SEM√ÅFOROS ‚Äì tiempos configurables
  // ==========================
  const northLights = {
    red: document.getElementById("north-red"),
    yellow: document.getElementById("north-yellow"),
    green: document.getElementById("north-green")
  };
  const southLights = {
    red: document.getElementById("south-red"),
    yellow: document.getElementById("south-yellow"),
    green: document.getElementById("south-green")
  };
  const eastLights = {
    red: document.getElementById("east-red"),
    yellow: document.getElementById("east-yellow"),
    green: document.getElementById("east-green")
  };
  const westLights = {
    red: document.getElementById("west-red"),
    yellow: document.getElementById("west-yellow"),
    green: document.getElementById("west-green")
  };

  let semTimeout = null;
  let semRunning = false;

  function updateRangeLabels() {
    const nsVal = parseInt(document.getElementById("range-ns-green").value, 10);
    const ewVal = parseInt(document.getElementById("range-ew-green").value, 10);
    const yVal  = parseInt(document.getElementById("range-yellow").value, 10);

    document.getElementById("val-ns-green").textContent = nsVal + " s";
    document.getElementById("val-ew-green").textContent = ewVal + " s";
    document.getElementById("val-yellow").textContent  = yVal + " s";

    const total = nsVal + ewVal + 2 * yVal;
    if (total > 0) {
      document.getElementById("sem-cycle").textContent = total + " s";
      document.getElementById("sem-ns-perc").textContent =
        Math.round(nsVal / total * 100) + "%";
      document.getElementById("sem-ew-perc").textContent =
        Math.round(ewVal / total * 100) + "%";
      document.getElementById("sem-y-perc").textContent =
        Math.round(2 * yVal / total * 100) + "%";
    }
  }

  ["range-ns-green","range-ew-green","range-yellow"].forEach(id => {
    document.getElementById(id).addEventListener("input", updateRangeLabels);
  });
  updateRangeLabels();

  function apagarTodosSemaforos() {
    [northLights, southLights, eastLights, westLights].forEach(dir => {
      Object.values(dir).forEach(l => l.classList.remove("on"));
    });
  }

  function setEstadoNSverde() {
    apagarTodosSemaforos();
    northLights.green.classList.add("on");
    southLights.green.classList.add("on");
    eastLights.red.classList.add("on");
    westLights.red.classList.add("on");
  }

  function setEstadoNSamarillo() {
    apagarTodosSemaforos();
    northLights.yellow.classList.add("on");
    southLights.yellow.classList.add("on");
    eastLights.red.classList.add("on");
    westLights.red.classList.add("on");
  }

  function setEstadoEWverde() {
    apagarTodosSemaforos();
    eastLights.green.classList.add("on");
    westLights.green.classList.add("on");
    northLights.red.classList.add("on");
    southLights.red.classList.add("on");
  }

  function setEstadoEWamarillo() {
    apagarTodosSemaforos();
    eastLights.yellow.classList.add("on");
    westLights.yellow.classList.add("on");
    northLights.red.classList.add("on");
    southLights.red.classList.add("on");
  }

  function setAllRed() {
    apagarTodosSemaforos();
    northLights.red.classList.add("on");
    southLights.red.classList.add("on");
    eastLights.red.classList.add("on");
    westLights.red.classList.add("on");
  }

  function stopSemCycle() {
    semRunning = false;
    if (semTimeout) {
      clearTimeout(semTimeout);
      semTimeout = null;
    }
  }

  function startSemCycle() {
    stopSemCycle();
    semRunning = true;
    const nsGreen = parseInt(document.getElementById("range-ns-green").value, 10) * 1000;
    const ewGreen = parseInt(document.getElementById("range-ew-green").value, 10) * 1000;
    const yellow  = parseInt(document.getElementById("range-yellow").value, 10) * 1000;
    const box = document.getElementById("resultado-sem");

    const fases = [
      { fn: setEstadoNSverde,    dur: nsGreen,
        desc: "Flujo activo: Norte‚ÄìSur en verde, Este‚ÄìOeste en rojo." },
      { fn: setEstadoNSamarillo, dur: yellow,
        desc: "Transici√≥n: Norte‚ÄìSur en amarillo, Este‚ÄìOeste en rojo." },
      { fn: setEstadoEWverde,    dur: ewGreen,
        desc: "Flujo activo: Este‚ÄìOeste en verde, Norte‚ÄìSur en rojo." },
      { fn: setEstadoEWamarillo, dur: yellow,
        desc: "Transici√≥n: Este‚ÄìOeste en amarillo, Norte‚ÄìSur en rojo." }
    ];

    let index = 0;
    function runPhase() {
      if (!semRunning) return;
      const fase = fases[index];
      fase.fn();
      box.textContent = "Estado actual: " + fase.desc;
      semTimeout = setTimeout(() => {
        index = (index + 1) % fases.length;
        runPhase();
      }, fase.dur);
    }
    runPhase();
  }

  document.getElementById("btn-start-sem").addEventListener("click", () => {
    startSemCycle();
  });

  document.getElementById("btn-stop-sem").addEventListener("click", () => {
    stopSemCycle();
    setAllRed();
    document.getElementById("resultado-sem").textContent =
      "Ciclo detenido. Todos los sem√°foros en rojo (estado seguro).";
  });

  document.getElementById("btn-fallo").addEventListener("click", () => {
    stopSemCycle();
    apagarTodosSemaforos();
    // Norte-sur apagado, solo este-oeste pasa
    eastLights.green.classList.add("on");
    westLights.green.classList.add("on");
    document.getElementById("resultado-sem").textContent =
      "Fallo simulado: sem√°foros norte-sur apagados. Solo este-oeste tiene paso.\n" +
      "En el grafo de tr√°fico, esto equivale a desactivar las aristas norte-sur.";
  });

  // Estado inicial: todo rojo
  setAllRed();
</script>
</body>
</html>
